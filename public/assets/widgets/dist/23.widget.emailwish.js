(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{115:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var r=n(112),s=n.n(r),o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},a=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function i(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,i)}u((r=r.apply(t,e||[])).next())}))},i=function(t,e){var n,r,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},u=function(t){var e=this;this.process_params=function(t,n){var r=function(r){if(t.hasOwnProperty(r)){var s=n?n+"["+r+"]":r,o=t[r];if("string"==typeof o)e.flattened_data.push({key:s,value:o});else if("number"==typeof o)e.flattened_data.push({key:s,value:o+""});else if("boolean"==typeof o)e.flattened_data.push({key:s,value:o?"true":"false"});else if(void 0===o);else{var a;Array.isArray(o)?(a={},o.forEach((function(t,e){return a[e+""]=t}))):a=o,e.process_params(a,s)}}};for(var s in t)r(s)},this.get_form_data=function(){return e.flattened_data},this.flattened_data=[],this.process_params(t,"")},c=function(){function t(){var e=this;this.getApiBaseURL=function(){return"http://builder.emailwish.com"},this.getCsrfToken=function(n){return void 0===n&&(n=!1),a(e,void 0,void 0,(function(){return i(this,(function(e){return[2,this.fetchCsrfToken().then((function(e){return t.hasError(e)||!e.token?"":e.token}))]}))}))},this.fetchCsrfToken=function(){return s.a.get(e.getApiBaseURL()+"/_api/v1/csrf-token",{withCredentials:!0}).then((function(t){return o({statusCode:t.status},t.data)})).catch((function(t){}))},this.ipLocation=function(){return s.a.get(e.getApiBaseURL()+"/_api/v1/ip-location",{withCredentials:!0}).then((function(t){return o({statusCode:t.status},t.data)})).catch((function(t){}))},this.handleCatch=function(t){return console.log("error"),console.log(t),t&&t.response&&t.response.status&&t.response.data?o(o({},t.response.data),{statusCode:t.response.status}):t instanceof s.a.Cancel?{statusCode:999,message:void 0}:{statusCode:999,message:"Network Error"}}}return t.getErrorString=function(t){return"string"==typeof t?t:t.join(" ")},t.csrfToken={token:"dummy_expired_token",expiry:new Date(0)},t.hasError=function(t){return!t||t.statusCode>=400||(!(t&&!t.validation_errors)||void 0)},t.getError=function(e){return e.message&&"string"==typeof e.message?e.message:e.validation_errors?e.validation_errors.csrf?t.getErrorString(e.validation_errors.csrf):e.validation_errors.network?t.getErrorString(e.validation_errors.network):e.validation_errors.email?t.getErrorString(e.validation_errors.email):e.validation_errors.password?t.getErrorString(e.validation_errors.password):e.validation_errors.name?t.getErrorString(e.validation_errors.name):"Unknown error!":t.getErrorFromStatusCode(e)},t.getErrorFromStatusCode=function(t){switch(t.statusCode){case 400:return"Request error: Bad Request";case 401:return"Request error: Unauthorized";case 402:return"Request error: Payment Required";case 403:return"Request error: Forbidden";case 404:return"Request error: Not Found";case 405:return"Request error: Method Not Allowed";case 500:return"Server error: Internal error";case 501:return"Server error: Not Implemented";case 502:return"Server error: Bad Gateway";case 503:return"Server error: Service Unavailable";case 504:return"Server error: Gateway Timeout";default:return"Unknown error"}},t}();e.b=c},116:function(t,e,n){"use strict";var r=n(1);e.a=()=>{const t=Object(r.useRef)(!1);return Object(r.useEffect)(()=>(t.current=!0,()=>t.current=!1),[]),t}},270:function(t,e,n){"use strict";var r,s=n(115),o=n(112),a=n.n(o),i=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),u=function(){return(u=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},c=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function i(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,i)}u((r=r.apply(t,e||[])).next())}))},f=function(t,e){var n,r,s,o,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(o){return function(i){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(s=a.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){a.label=o[1];break}if(6===o[0]&&a.label<s[1]){a.label=s[1],s=o;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(o);break}s[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,i])}}},h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.getCustomerAvatarURL=function(t,n){return e.getApiBaseURL()+"/assets/images/avatar/customer-"+t+".jpg?t="+n},e.update_form=function(t,n){return c(e,void 0,void 0,(function(){var e,r=this;return f(this,(function(s){return(e=new FormData).set("name",t.name),e.set("email",t.email),e.set("session_id",n&&n.id.toString()||""),e.set("secret_key",n&&n.secret_key.toString()||""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/sessions/update",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return r.handleCatch(t)}))]}))}))},e.end_chat=function(t){return c(e,void 0,void 0,(function(){var e,n=this;return f(this,(function(r){return(e=new FormData).set("session_id",t&&t.id.toString()||""),e.set("secret_key",t&&t.secret_key.toString()||""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/sessions/end_chat",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return n.handleCatch(t)}))]}))}))},e.no_end_chat=function(t){return c(e,void 0,void 0,(function(){var e,n=this;return f(this,(function(r){return(e=new FormData).set("session_id",t&&t.id.toString()||""),e.set("secret_key",t&&t.secret_key.toString()||""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/sessions/no_end_chat",e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return n.handleCatch(t)}))]}))}))},e.get_session=function(t){return c(e,void 0,void 0,(function(){var e=this;return f(this,(function(n){return[2,a.a.get(this.getApiBaseURL()+"/_shopify/chat/sessions/get_or_create",{headers:{"Content-Type":"application/json"},withCredentials:!0,params:{client_uid:t}}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return e.handleCatch(t)}))]}))}))},e.end_session=function(t,n,r){return c(e,void 0,void 0,(function(){var e,s=this;return f(this,(function(o){return(e=new FormData).set("session_id",t&&t.id.toString()||""),e.set("secret_key",t&&t.secret_key.toString()||""),e.set("feedback_rating",n.toString()||""),e.set("feedback_message",r.toString()||""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/sessions/end",e,{withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return s.handleCatch(t)}))]}))}))},e.read_messages=function(t,n){return c(e,void 0,void 0,(function(){var e=this;return f(this,(function(r){return[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/messages/read",{session_id:t&&t.id,secret_key:t&&t.secret_key,last_id:n},{headers:{"Content-Type":"application/json"},withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return e.handleCatch(t)}))]}))}))},e.send_messages=function(t,n,r,s){return c(e,void 0,void 0,(function(){var e,o=this;return f(this,(function(i){return(e=new FormData).set("message",t),n&&e.set("attachment",n),e.set("session_id",r&&r.id.toString()||""),e.set("secret_key",r&&r.secret_key||""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/messages/send",e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0,onUploadProgress:n&&s}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return o.handleCatch(t)}))]}))}))},e.send_messages_end_chat=function(t){return c(e,void 0,void 0,(function(){var e,n=this;return f(this,(function(r){return(e=new FormData).set("session_id",t&&t.id.toString()||""),e.set("secret_key",t&&t.secret_key||""),e.set("message_type","end_chat"),e.set("message",""),[2,a.a.post(this.getApiBaseURL()+"/_shopify/chat/messages/send",e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}).then((function(t){return u({statusCode:t.status},t.data)})).catch((function(t){return n.handleCatch(t)}))]}))}))},e}return i(e,t),e}(s.b);e.a=h},66:function(t,e,n){"use strict";n.r(e);var r=n(3),s=n(1),o=n(270),a=n(116),i=function(){return(i=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};e.default=function(t){var e=t.client_id,u=Object(s.lazy)((function(){return Promise.all([n.e(0),n.e(1),n.e(4),n.e(5),n.e(10)]).then(n.bind(null,405))})),c=Object(a.a)(),f=Object(s.useState)(),h=f[0],l=f[1],d=Object(s.useState)(!1),p=d[0],_=d[1];return Object(s.useEffect)((function(){(new o.a).get_session(e).then((function(t){c.current&&(o.a.hasError(t)||l(t))}))}),[c,e]),h?Object(r.jsx)(s.Suspense,i({fallback:null},{children:h.chat_session&&h.chat_settings&&Object(r.jsx)(u,{restart_session:function(){(new o.a).get_session(e).then((function(t){c.current&&(o.a.hasError(t)||(l(t),_(!0)))}))},guest_session:h.chat_session,ui_testing:!1,preview:p,chat_settings:h.chat_settings,logo_image:h.chat_settings.bot_image},h.chat_session&&h.chat_session.id)}),void 0):null}}}]);